# [Todo 完了機能の拡張実装]

## 1. 概要

Todo の完了機能を拡張し、完了日時の記録と完了状態の視覚的な表示を改善する実装を行います。

## 2. 要件整理

### 機能要件

- 要件 1: Todo が完了したときに、完了日時を記録する
- 要件 2: Todo が完了したときに、ステータスを完了に変更する
- 要件 3: 完了済みの Todo を画面上で視覚的に区別できるようにする

### 技術要件

- 追加技術: なし（既存の Prisma と React の機能で実装可能）
- データベース変更: completedAt フィールドの追加

## 3. 影響範囲

### システム影響

- 影響コンポーネント:

  - Prisma スキーマ（新規フィールド追加）
  - Todo モデルの TypeScript 型定義
  - Todo のビジネスロジック層
  - UI コンポーネント（完了日時の表示）

- 依存関係の変更: なし

## 4. 変更対象

### 設定ファイル

- prisma/schema.prisma:
  - completedAt フィールドの追加

### ソースコード

- app/models/todo.ts:

  - Todo interface に completedAt フィールドを追加

- app/lib/todo.ts:

  - updateTodoStatus 関数の更新（completedAt の設定を追加）

- app/components/todo/TodoItem.tsx:
  - 完了日時の表示を追加
  - 完了状態の視覚的表現を強化

## 5. タスク分解

1. データベース更新

   - 内容: completedAt フィールドの追加とマイグレーション
   - 工数: 0.5h

2. モデル・ロジック更新

   - 内容: TypeScript 型定義とビジネスロジックの更新
   - 工数: 0.5h

3. UI 実装

   - 内容: 完了日時の表示とスタイル調整
   - 工数: 1h

4. テスト
   - 内容: 機能テストと UI 確認
   - 工数: 1h

## 6. 実装方針

### 基本方針

- 既存の Todo 完了機能を拡張する形で実装
- データベースマイグレーションは既存データに影響を与えないよう注意
- UI の変更は既存のデザインに調和するよう配慮

### 技術的注意点

- completedAt フィールドは nullable（未完了の Todo の場合は null）
- 完了状態の切り替え時に completedAt の値も適切に更新する
- タイムゾーンの扱いに注意（UTC 保存、表示時にローカル時間変換）

### 実装ステップ

1. データベース更新

   - schema.prisma に completedAt フィールドを追加
   - マイグレーションの実行

2. TypeScript 型定義の更新

   - Todo interface に completedAt を追加
   - 関連する型の更新

3. ビジネスロジックの更新

   - updateTodoStatus 関数に completedAt の更新処理を追加
   - 完了状態の切り替え時の日時処理を実装

4. UI 更新
   - TodoItem コンポーネントに完了日時の表示を追加
   - 完了状態の視覚的表現を強化

### パフォーマンスへの影響

- データベース変更による影響は最小限
- 追加されるフィールドはインデックス不要
- UI 更新による大きなパフォーマンス影響なし

### セキュリティリスク

- 特になし（データの機密性は既存機能と同レベル）

### テスト戦略

1. ユニットテスト

   - updateTodoStatus 関数のテスト
   - 日時処理の正確性確認

2. 統合テスト

   - 完了処理の一連のフロー確認
   - データベース更新の確認

3. UI テスト
   - 完了状態の表示確認
   - 日時フォーマットの確認
